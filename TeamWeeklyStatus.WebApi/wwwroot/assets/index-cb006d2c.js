import{r as n,b as Z,c as ee,d as se,j as e,e as te,a as P,u as ae,F as o,A as I,C as v,B as p,m as R}from"./index-2375c4d2.js";import{h as i}from"./moment-fbc5633a.js";const E=n.forwardRef(({bsPrefix:f,className:N,as:_="div",...d},k)=>{const j=Z(f,"row"),m=ee(),y=se(),x=`${j}-cols`,u=[];return m.forEach(c=>{const l=d[c];delete d[c];let h;l!=null&&typeof l=="object"?{cols:h}=l:h=l;const g=c!==y?`-${c}`:"";h!=null&&u.push(`${x}${g}-${h}`)}),e.jsx(_,{ref:k,...d,className:te(N,j,...u)})});E.displayName="Row";const B=E;const le=()=>{const{role:f,teamName:N,memberName:_,memberId:d}=P(),[k,j]=n.useState(d),[m,y]=n.useState(null),[x,u]=n.useState([""]),[c,l]=n.useState([""]),[h,g]=n.useState(""),[D,T]=n.useState([]),[A,Y]=n.useState(null),[$,W]=n.useState(!1),[w,F]=n.useState(null),G=i().startOf("week").toDate(),[S,oe]=n.useState(G),L=i().endOf("week").toDate(),U=i().add(1,"weeks").startOf("isoWeek");i().add(1,"weeks").endOf("isoWeek");const q=i().add(2,"months").endOf("isoWeek"),C=ae();n.useEffect(()=>{const t=P.subscribe(s=>{s.memberId!==k&&j(s.memberId)});return()=>t()},[]),n.useEffect(()=>{(async()=>{const s={memberId:d,weekStartDate:S.toISOString()},a=await R("/WeeklyStatus/GetByMemberIdAndStartDate","POST",s);a&&(y(a),u(a.doneThisWeek),l(a.planForNextWeek),T(a.upcomingPTO.map(r=>typeof r=="string"?r:r.toISOString().split("T")[0])),g(a.blockers))})()},[k,S]);const z=(t,s,a)=>{const r=[...x];r[t]=s,a(r)},V=(t,s)=>{const a=[...c];a[t]=s,l(a)},H=t=>{const s=t.target.value,a=D.indexOf(s);T(a!==-1?r=>r.filter(b=>b!==s):r=>[...r,s]),Y(null)},M=t=>{t(s=>[...s,""])},O=(t,s)=>{s(a=>a.filter((r,b)=>b!==t))},J=async t=>{t.preventDefault();const s={id:(m==null?void 0:m.id)||0,weekStartDate:S,doneThisWeek:x,planForNextWeek:c,upcomingPTO:D,blockers:h,memberId:d};console.log(s);try{const b=await R(m?"/WeeklyStatus/Edit":"/WeeklyStatus/Add",m?"PUT":"POST",s);K()}catch{W(!1),F("An error occurred. Please try again.")}},K=()=>{W(!0),setTimeout(()=>{W(!1)},5e3)},Q=()=>{C("/status-reporting")},X=()=>{C("/assign-reporter")};return e.jsx("div",{className:"d-flex flex-column align-items-center mt-5",children:e.jsxs(o,{onSubmit:J,className:"form__container",children:[e.jsxs("h2",{children:["Team ",N]}),e.jsxs("h3",{children:["Welcome ",_,"!"]}),e.jsxs("h3",{children:["Weekly Status: ",i(S).format("MMM DD")," -"," ",i(L).format("MMM DD")]}),$&&e.jsx(I,{variant:"success",className:"mt-3",children:"Your weekly status has been saved!"}),w&&e.jsx(I,{variant:"danger",className:"mt-3",children:w}),e.jsxs(o.Group,{controlId:"doneThisWeek",className:"form__group",children:[e.jsx(o.Label,{className:"form__label",children:"What was done this week:"}),x.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(B,{children:[e.jsx(v,{children:e.jsx(o.Control,{type:"text",placeholder:`Task ${s+1}`,value:t,onChange:a=>z(s,a.target.value,u)})}),e.jsx(v,{xs:"auto",children:e.jsx(p,{variant:"danger",onClick:()=>O(s,u),children:"Remove"})})]})},s)),e.jsx(p,{variant:"secondary",onClick:()=>M(u),children:"Add Task"})]}),e.jsxs(o.Group,{controlId:"planForNextWeek",className:"form__group",children:[e.jsx(o.Label,{className:"form__label",children:"Plan for Next Week"}),c.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(B,{children:[e.jsx(v,{children:e.jsx(o.Control,{type:"text",placeholder:`Plan ${s+1}`,value:t,onChange:a=>V(s,a.target.value)})}),e.jsx(v,{xs:"auto",children:e.jsx(p,{variant:"danger",onClick:()=>O(s,l),children:"Remove"})})]})},s)),e.jsx(p,{variant:"secondary",onClick:()=>M(l),children:"Add Plan"})]}),e.jsxs(o.Group,{controlId:"upcomingPTO",className:"form__group",children:[e.jsx(o.Label,{className:"form__label",children:"Upcoming PTO"}),e.jsx(o.Control,{type:"date",value:A||"",min:U.format("YYYY-MM-DD"),max:q.format("YYYY-MM-DD"),onChange:H})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"form__label",children:"Selected dates: "}),D.map(t=>i(t).format("MMM DD")).join(", ")]}),e.jsxs(o.Group,{controlId:"blockers",className:"form__group",children:[e.jsx(o.Label,{className:"form__label",children:"Blockers"}),e.jsx(o.Control,{as:"textarea",rows:3,value:h,onChange:t=>g(t.target.value)})]}),e.jsxs(o.Group,{controlId:"buttons",className:"form__btngroup",children:[e.jsx(p,{variant:"primary",type:"submit",className:"form__btn",children:"Save Weekly Status"}),f==="CurrentWeekReporter"&&e.jsx(p,{variant:"primary",onClick:Q,className:"form__btn",children:"Report"}),f==="TeamLead"&&e.jsx(p,{variant:"primary",onClick:X,children:"Assign Reporter"})]})]})})};export{le as default};
