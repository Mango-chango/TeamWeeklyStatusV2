import{a as C,r as o,u as X,j as e,F as r,A as M,C as p,B as l,m as w}from"./index-99215cd0.js";import{h as c}from"./moment-fbc5633a.js";import{R as P}from"./Row-ca56b173.js";const ae=()=>{const{role:b,teamName:O,memberName:I,memberId:x}=C(),[v,R]=o.useState(x),[i,E]=o.useState(null),[k,m]=o.useState([""]),[f,d]=o.useState([""]),[N,_]=o.useState(""),[g,j]=o.useState([]),[A,Y]=o.useState(null),[F,S]=o.useState(!1),[D,G]=o.useState(null),L=c().startOf("week").toDate(),[u,Z]=o.useState(L),B=c().endOf("week").toDate(),U=c().add(1,"weeks").startOf("isoWeek"),q=c().add(1,"weeks").endOf("isoWeek"),y=X();o.useEffect(()=>{const t=C.subscribe(s=>{s.memberId!==v&&R(s.memberId)});return()=>t()},[]),o.useEffect(()=>{(async()=>{const s={memberId:x,weekStartDate:u.toISOString()},a=await w("/WeeklyStatus/GetByMemberIdAndStartDate","POST",s);a&&(E(a),m(a.doneThisWeek),d(a.planForNextWeek),j(a.upcomingPTO.map(n=>typeof n=="string"?n:n.toISOString().split("T")[0])),_(a.blockers))})()},[v,u]);const $=(t,s,a)=>{const n=[...k];n[t]=s,a(n)},z=(t,s)=>{const a=[...f];a[t]=s,d(a)},H=t=>{const s=t.target.value,a=g.indexOf(s);j(a!==-1?n=>n.filter(h=>h!==s):n=>[...n,s]),Y(null)},T=t=>{t(s=>[...s,""])},W=(t,s)=>{s(a=>a.filter((n,h)=>h!==t))},J=async t=>{t.preventDefault();const s={id:(i==null?void 0:i.id)||0,weekStartDate:u,doneThisWeek:k,planForNextWeek:f,upcomingPTO:g,blockers:N,memberId:x};console.log(s);try{const h=await w(i?"/WeeklyStatus/Edit":"/WeeklyStatus/Add",i?"PUT":"POST",s);K()}catch{S(!1),G("An error occurred. Please try again.")}},K=()=>{S(!0),setTimeout(()=>{S(!1)},5e3)},Q=()=>{y("/status-reporting")},V=()=>{y("/assign-reporter")};return e.jsx("div",{className:"d-flex flex-column align-items-center mt-5",children:e.jsxs(r,{onSubmit:J,className:"form__container",children:[e.jsxs("h2",{children:["Team ",O]}),e.jsxs("h3",{children:["Welcome ",I,"!"]}),e.jsxs("h3",{children:["Weekly Status: ",c(u).format("MMM DD")," -"," ",c(B).format("MMM DD")]}),F&&e.jsx(M,{variant:"success",className:"mt-3",children:"Your weekly status has been saved!"}),D&&e.jsx(M,{variant:"danger",className:"mt-3",children:D}),e.jsxs(r.Group,{controlId:"doneThisWeek",className:"form__group",children:[e.jsx(r.Label,{className:"form__label",children:"What was done this week:"}),k.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(P,{children:[e.jsx(p,{children:e.jsx(r.Control,{type:"text",placeholder:`Task ${s+1}`,value:t,onChange:a=>$(s,a.target.value,m)})}),e.jsx(p,{xs:"auto",children:e.jsx(l,{variant:"danger",onClick:()=>W(s,m),children:"Remove"})})]})},s)),e.jsx(l,{variant:"secondary",onClick:()=>T(m),children:"Add Task"})]}),e.jsxs(r.Group,{controlId:"planForNextWeek",className:"form__group",children:[e.jsx(r.Label,{className:"form__label",children:"Plan for Next Week"}),f.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(P,{children:[e.jsx(p,{children:e.jsx(r.Control,{type:"text",placeholder:`Plan ${s+1}`,value:t,onChange:a=>z(s,a.target.value)})}),e.jsx(p,{xs:"auto",children:e.jsx(l,{variant:"danger",onClick:()=>W(s,d),children:"Remove"})})]})},s)),e.jsx(l,{variant:"secondary",onClick:()=>T(d),children:"Add Plan"})]}),e.jsxs(r.Group,{controlId:"upcomingPTO",className:"form__group",children:[e.jsx(r.Label,{className:"form__label",children:"Upcoming PTO"}),e.jsx(r.Control,{type:"date",value:A||"",min:U.format("YYYY-MM-DD"),max:q.format("YYYY-MM-DD"),onChange:H})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"form__label",children:"Selected dates: "}),g.map(t=>c(t).format("MMM DD")).join(", ")]}),e.jsxs(r.Group,{controlId:"blockers",className:"form__group",children:[e.jsx(r.Label,{className:"form__label",children:"Blockers"}),e.jsx(r.Control,{as:"textarea",rows:3,value:N,onChange:t=>_(t.target.value)})]}),e.jsxs(r.Group,{controlId:"buttons",className:"form__btngroup",children:[e.jsx(l,{variant:"primary",type:"submit",className:"form__btn",children:"Save Weekly Status"}),b==="CurrentWeekReporter"&&e.jsx(l,{variant:"primary",onClick:Q,className:"form__btn",children:"Report"}),b==="TeamLead"&&e.jsx(l,{variant:"primary",onClick:V,children:"Assign Reporter"})]})]})})};export{ae as default};
