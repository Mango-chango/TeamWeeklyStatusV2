import{r as c,b as ne,c as re,d as ce,j as e,e as le,a as P,u as ie,F as n,A as R,C as D,B as u,m as B}from"./index-e78f6d33.js";import{h as m}from"./moment-fbc5633a.js";const A=c.forwardRef(({bsPrefix:f,className:v,as:_="div",...p},x)=>{const b=ne(f,"row"),h=re(),N=ce(),g=`${b}-cols`,l=[];return h.forEach(d=>{const i=p[d];delete p[d];let k;i!=null&&typeof i=="object"?{cols:k}=i:k=i;const j=d!==N?`-${d}`:"";k!=null&&l.push(`${g}${j}-${k}`)}),e.jsx(_,{ref:x,...p,className:le(v,b,...l)})});A.displayName="Row";const E=A;const pe=()=>{const{role:f,teamName:v,memberName:_,memberId:p}=P(),[x,b]=c.useState(p),[h,N]=c.useState(null),[g,l]=c.useState([{taskDescription:"",subtasks:[{subtaskDescription:""}]}]),[d,i]=c.useState([""]),[k,j]=c.useState(""),[T,y]=c.useState([]),[Y,$]=c.useState(null),[F,C]=c.useState(!1),[w,W]=c.useState(!1),G=m().startOf("week").toDate(),[S,de]=c.useState(G),L=m().endOf("week").toDate(),I=m().add(1,"weeks").startOf("isoWeek");m().add(1,"weeks").endOf("isoWeek");const U=m().add(2,"months").endOf("isoWeek"),M=ie();c.useEffect(()=>{const t=P.subscribe(s=>{s.memberId!==x&&b(s.memberId)});return()=>t()},[]),c.useEffect(()=>{(async()=>{const s={memberId:p,weekStartDate:S.toISOString()},a=await B("/WeeklyStatus/GetByMemberIdAndStartDate","POST",s);a&&(N(a),l(a.doneThisWeek),i(a.planForNextWeek),y(a.upcomingPTO.map(o=>typeof o=="string"?o:o.toISOString().split("T")[0])),j(a.blockers))})()},[x,S]);const q=(t,s,a,o)=>{o(r=>{const O=[...r];return O[t].subtasks[s]={subtaskDescription:a},O})},z=(t,s)=>{s(a=>{console.log("Adding subtask");const o=[...a];return o[t].subtasks.push({subtaskDescription:""}),o})},V=(t,s,a)=>{a(o=>{const r=[...o];return r[t]={...r[t],taskDescription:s},r})},H=(t,s)=>{const a=[...d];a[t]=s,i(a)},J=t=>{const s=t.target.value,a=T.indexOf(s);y(a!==-1?o=>o.filter(r=>r!==s):o=>[...o,s]),$(null)},K=t=>{t(s=>[...s,{taskDescription:"",subtasks:[]}])},Q=t=>{t(s=>[...s,""])},X=(t,s)=>{s(a=>a.filter((o,r)=>r!==t))},Z=(t,s)=>{s(a=>a.filter((o,r)=>r!==t))},ee=async t=>{t.preventDefault();const s={id:(h==null?void 0:h.id)||0,weekStartDate:S,doneThisWeek:g.map(a=>({taskDescription:a.taskDescription,subtasks:a.subtasks.filter(o=>o.subtaskDescription.trim()!=="").map(o=>({subtaskDescription:o.subtaskDescription}))})),planForNextWeek:d,upcomingPTO:T,blockers:k,memberId:p};console.log(s);try{const r=await B(h?"/WeeklyStatus/Edit":"/WeeklyStatus/Add",h?"PUT":"POST",s);se()}catch{C(!1),te()}},se=()=>{C(!0),setTimeout(()=>{C(!1)},5e3)},te=()=>{W(!0),setTimeout(()=>{W(!1)},8e3)},ae=()=>{M("/status-reporting")},oe=()=>{M("/assign-reporter")};return e.jsx("div",{className:"d-flex flex-column align-items-center mt-5",children:e.jsxs(n,{onSubmit:ee,className:"form__container",children:[e.jsxs("h2",{children:["Team ",v]}),e.jsxs("h3",{children:["Welcome ",_,"!"]}),e.jsxs("h3",{children:["Weekly Status: ",m(S).format("MMM DD")," -"," ",m(L).format("MMM DD")]}),F&&e.jsx(R,{variant:"success",className:"mt-3",children:"Your weekly status has been saved!"}),w&&e.jsx(R,{variant:"danger",className:"mt-3",children:w}),e.jsxs(n.Group,{controlId:"doneThisWeek",className:"form__group",children:[e.jsx(n.Label,{className:"form__label",children:"What was done this week:"}),g.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(E,{children:[e.jsxs(D,{children:[e.jsx(n.Control,{type:"text",placeholder:`Task ${s+1}`,value:t.taskDescription,onChange:a=>V(s,a.target.value,l)}),t.subtasks.map((a,o)=>e.jsx("div",{className:"form__group__subtask",children:e.jsx(n.Control,{type:"text",placeholder:`Subtask ${o+1}`,value:a.subtaskDescription,onChange:r=>q(s,o,r.target.value,l)},o)},o)),e.jsx(u,{variant:"secondary",onClick:()=>z(s,l),children:"Add Subtask"})]}),e.jsx(D,{xs:"auto",children:e.jsx(u,{variant:"danger",onClick:()=>X(s,l),children:"Remove"})})]})},s)),e.jsx(u,{variant:"secondary",onClick:()=>K(l),children:"Add Task"})]}),e.jsxs(n.Group,{controlId:"planForNextWeek",className:"form__group",children:[e.jsx(n.Label,{className:"form__label",children:"Plan for Next Week"}),d.map((t,s)=>e.jsx("div",{className:"mb-2",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsx(n.Control,{type:"text",placeholder:`Plan ${s+1}`,value:t,onChange:a=>H(s,a.target.value)})}),e.jsx(D,{xs:"auto",children:e.jsx(u,{variant:"danger",onClick:()=>Z(s,i),children:"Remove"})})]})},s)),e.jsx(u,{variant:"secondary",onClick:()=>Q(i),children:"Add Plan"})]}),e.jsxs(n.Group,{controlId:"upcomingPTO",className:"form__group",children:[e.jsx(n.Label,{className:"form__label",children:"Upcoming PTO"}),e.jsx(n.Control,{type:"date",value:Y||"",min:I.format("YYYY-MM-DD"),max:U.format("YYYY-MM-DD"),onChange:J})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"form__label",children:"Selected dates: "}),T.map(t=>m(t).format("MMM DD")).join(", ")]}),e.jsxs(n.Group,{controlId:"blockers",className:"form__group",children:[e.jsx(n.Label,{className:"form__label",children:"Blockers"}),e.jsx(n.Control,{as:"textarea",rows:3,value:k,onChange:t=>j(t.target.value)})]}),e.jsxs(n.Group,{controlId:"buttons",className:"form__btngroup",children:[e.jsx(u,{variant:"primary",type:"submit",className:"form__btn",children:"Save Weekly Status"}),f==="CurrentWeekReporter"&&e.jsx(u,{variant:"primary",onClick:ae,className:"form__btn",children:"Report"}),f==="TeamLead"&&e.jsx(u,{variant:"primary",onClick:oe,children:"Assign Reporter"})]})]})})};export{pe as default};
